---
# Certificate for Couchbase admission controller TLS (webhook).
# issuerRef.name is set by Kustomize replacement from cert-manager-admission-issuer-config
# (default in root overlay: lab-ca-issuer; ApplicationSet overlays can use different issuers).
# Sync wave -1 so this is applied before the Helm release.
# Operator and admission controller run in couchbase-operator namespace.
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: operator-couchbase-admission-tls
  namespace: couchbase-operator
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
spec:
  secretName: operator-couchbase-admission-tls
  duration: 8760h  # 1 year
  renewBefore: 720h # 30 days
  subject:
    organizations:
      - couchbase
  commonName: operator-couchbase-admission-controller.couchbase-operator.svc
  privateKey:
    algorithm: RSA
    size: 2048
  usages:
    - server auth
  dnsNames:
    - operator-couchbase-admission-controller
    - operator-couchbase-admission-controller.couchbase-operator
    - operator-couchbase-admission-controller.couchbase-operator.svc
    - operator-couchbase-admission-controller.couchbase-operator.svc.cluster.local
  issuerRef:
    name: PLACEHOLDER_ISSUER
    kind: ClusterIssuer
    group: cert-manager.io
